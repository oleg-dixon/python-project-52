{% extends "base.html" %}
{% load i18n %}
{% load django_bootstrap5 %}

{% block title %}
{% if action == 'delete' %}
    {% trans "Удаление задачи" %}
{% elif action == 'update' %}
    {% trans "Изменение задачи" %}
{% else %}
    {% trans "Создание задачи" %}
{% endif %} | {% trans "Менеджер задач" %}
{% endblock %}

{% block content %}
<div class="container mt-4">

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="{% trans "Закрыть" %}"></button>
            </div>
        {% endfor %}
    {% endif %}

    <h1 class="text-center mb-4">
        {% if action == 'delete' %}
            {% trans "Удаление задачи" %}
        {% elif action == 'update' %}
            {% trans "Изменение задачи" %}
        {% else %}
            {% trans "Создание задачи" %}
        {% endif %}
    </h1>

    {% if action == 'delete' %}
        <!-- Удаление -->
        <div class="card shadow-sm">
            <div class="card-header bg-danger text-white text-center">
                <i class="bi bi-exclamation-triangle"></i> {% trans "Внимание!" %}
            </div>
            <div class="card-body">
                <div class="alert alert-warning" role="alert">
                    <h5 class="alert-heading">{% trans "Внимание!" %}</h5>
                    <p>{% trans "Вы собираетесь удалить задачу. Это действие невозможно отменить." %}</p>
                </div>

                <div class="task-info mb-4 p-3 bg-light rounded">
                    <h5>{% trans "Информация о задаче:" %}</h5>
                    <ul class="list-unstyled">
                        <li><strong>{% trans "Название:" %}</strong> {{ object.name }}</li>
                        <li><strong>{% trans "Статус:" %}</strong> {{ object.status|default:"-" }}</li>
                        <li><strong>{% trans "Автор:" %}</strong> {{ object.author.username }}</li>
                        <li><strong>{% trans "Исполнитель:" %}</strong>
                            {% if object.executor %}{{ object.executor.username }}{% else %}-{% endif %}
                        </li>
                        <li><strong>{% trans "Теги:" %}</strong>
                            {% for label in object.labels.all %}
                                <span class="badge bg-secondary">{{ label.name }}</span>
                            {% empty %}
                                -
                            {% endfor %}
                        </li>
                        <li><strong>{% trans "Дата создания:" %}</strong> {{ object.get_local_created_at|date:"d.m.Y H:i" }}</li>
                        <li><strong>{% trans "Дата обновления:" %}</strong> {{ object.get_local_updated_at|date:"d.m.Y H:i" }}</li>
                    </ul>
                </div>

                <form method="post">
                    {% csrf_token %}
                    <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                        <button type="submit" class="btn btn-danger">{% trans "Удалить" %}</button>
                        <a href="{% url 'tasks:index' %}" class="btn btn-secondary">{% trans "Отмена" %}</a>
                    </div>
                </form>
            </div>
        </div>

    {% else %}
        <!-- Создание / Изменение -->
        <form method="post" class="needs-validation">
            {% csrf_token %}
            {% bootstrap_form form %}
            <button type="submit" class="btn btn-primary mt-3">
                {% if action == 'update' %}
                    {% trans "Сохранить изменения" %}
                {% else %}
                    {% trans "Создать задачу" %}
                {% endif %}
            </button>
            <a href="{% url 'tasks:index' %}" class="btn btn-secondary mt-3">{% trans "Отмена" %}</a>
        </form>
    {% endif %}

</div>
{% endblock %}
